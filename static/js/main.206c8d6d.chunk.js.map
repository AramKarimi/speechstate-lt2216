{"version":3,"sources":["dmColourChanger.ts","index.tsx"],"names":["sayColour","send","context","type","value","recResult","utterance","say","text","_context","dmMachine","initial","states","idle","on","CLICK","init","TTS_READY","welcome","RECOGNISED","target","cond","TIMEOUT","prompt","entry","ENDSPEECH","ask","stop","always","repaint","dm","actions","cancel","REGION","inspect","url","iframe","machine","Machine","id","gui","micOnly","SHOW_ALTERNATIVES","showAlternatives","SELECT","asrtts","assign","audioCtx","_ctx","window","AudioContext","webkitAudioContext","navigator","mediaDevices","getUserMedia","audio","then","stream","createMediaStreamSource","getToken","invoke","src","_evt","getAuthorizationToken","onDone","event","azureAuthorizationToken","data","onError","ponyfillTTS","_event","callback","_onReceive","ponyfill","createSpeechSynthesisPonyfill","audioContext","credentials","region","authorizationToken","speechSynthesis","SpeechSynthesisUtterance","tts","ttsUtterance","addEventListener","voices","getVoices","voiceRe","RegExp","process","voice","find","v","test","name","console","error","TTS_ERROR","LISTEN","SPEAK","ttsAgenda","recognising","exit","ASRRESULT","noinput","delay","tdmPassivity","STARTSPEECH","inprogress","match","pause","speaking","fail","recLogResult","log","logIntent","nluData","intent","ReactiveButton","props","promptText","state","tdmVisualOutputInfo","el","attribute","promptImage","circleClass","matches","className","alt","style","FigureButton","caption","alternative","imageSrc","App","useMachine","devTools","recStart","asEffect","asr","start","recStop","abort","ttsStart","onend","speak","ttsStop","ponyfillASR","SpeechRecognition","createSpeechRecognitionPonyfill","lang","continuous","interimResults","onresult","result","results","isFinal","transcript","confidence","current","figureButtons","tdmExpectedAlternatives","filter","o","visual_information","map","i","onClick","semantic_expression","fetch","Request","method","headers","rootElement","document","getElementById","ReactDOM"],"mappings":"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","file":"static/js/main.206c8d6d.chunk.js","sourcesContent":["import { MachineConfig, send, Action } from \"xstate\";\n\n\nconst sayColour: Action<SDSContext, SDSEvent> = send((context: SDSContext) => ({\n    type: \"SPEAK\", value: `Repainting to ${context.recResult[0].utterance}`\n}))\n\nfunction say(text: string): Action<SDSContext, SDSEvent> {\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\n}\n\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\n    initial: 'idle',\n    states: {\n        idle: {\n            on: {\n                CLICK: 'init'\n            }\n        },\n        init: {\n            on: {\n                TTS_READY: 'welcome',\n                CLICK: 'welcome'\n            }\n        },\n\n        welcome: {\n            initial: 'prompt',\n            on: {\n                RECOGNISED: [\n                    { target: 'stop', cond: (context) => context.recResult[0].utterance === 'Stop.' },\n                    { target: 'repaint' }],\n                TIMEOUT: '..',\n            },\n            states: {\n                prompt: {\n                    entry: say(\"Tell me the colour\"),\n                    on: { ENDSPEECH: 'ask' }\n                },\n                ask: {\n                    entry: send('LISTEN'),\n                },\n            }\n        },\n        stop: {\n            entry: say(\"Ok\"),\n            always: 'init'\n        },\n        repaint: {\n            initial: 'prompt',\n            states: {\n                prompt: {\n                    entry: sayColour,\n                    on: { ENDSPEECH: 'repaint' }\n                },\n                repaint: {\n                    entry: 'changeColour',\n                    always: '#root.dm.welcome'\n                }\n            }\n        }\n    }\n})\n","import \"./styles.scss\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Machine, assign, actions, State } from \"xstate\";\nimport { useMachine, asEffect } from \"@xstate/react\";\nimport { inspect } from \"@xstate/inspect\";\nimport { dmMachine } from \"./dmColourChanger\";\n\nimport createSpeechRecognitionPonyfill from 'web-speech-cognitive-services/lib/SpeechServices/SpeechToText'\nimport createSpeechSynthesisPonyfill from 'web-speech-cognitive-services/lib/SpeechServices/TextToSpeech';\n\nlet dm = dmMachine\n\nconst { send, cancel } = actions\n\nconst TOKEN_ENDPOINT = 'https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken';\nconst REGION = 'northeurope';\n\ninspect({\n    url: \"https://statecharts.io/inspect\",\n    iframe: false\n});\n\n\nconst defaultPassivity = 10\n\nconst machine = Machine<SDSContext, any, SDSEvent>({\n    id: 'root',\n    type: 'parallel',\n    states: {\n        dm: {\n            ...dm\n        },\n\n        gui: {\n            initial: 'micOnly',\n            states: {\n                micOnly: {\n                    on: { SHOW_ALTERNATIVES: 'showAlternatives' },\n                },\n                showAlternatives: {\n                    on: { SELECT: 'micOnly' },\n                }\n            }\n        },\n\n        asrtts: {\n            initial: 'init',\n            states: {\n                init: {\n                    on: {\n                        CLICK: {\n                            target: 'getToken',\n                            actions: [\n                                assign({\n                                    audioCtx: (_ctx) =>\n                                        new ((window as any).AudioContext || (window as any).webkitAudioContext)()\n                                }),\n                                (context) =>\n                                    navigator.mediaDevices.getUserMedia({ audio: true })\n                                        .then(function(stream) { context.audioCtx.createMediaStreamSource(stream) })\n                            ]\n                        }\n                    }\n                },\n                getToken: {\n                    invoke: {\n                        id: \"getAuthorizationToken\",\n                        src: (_ctx, _evt) => getAuthorizationToken(),\n                        onDone: {\n                            actions: [\n                                assign((_context, event) => { return { azureAuthorizationToken: event.data } }),\n                                'ponyfillASR'],\n                            target: 'ponyfillTTS'\n                        },\n                        onError: {\n                            target: 'fail'\n                        }\n                    }\n                },\n                ponyfillTTS: {\n                    invoke: {\n                        id: 'ponyTTS',\n                        src: (context, _event) => (callback, _onReceive) => {\n                            const ponyfill = createSpeechSynthesisPonyfill({\n                                audioContext: context.audioCtx,\n                                credentials: {\n                                    region: REGION,\n                                    authorizationToken: context.azureAuthorizationToken,\n                                }\n                            });\n                            const { speechSynthesis, SpeechSynthesisUtterance } = ponyfill;\n                            context.tts = speechSynthesis\n                            context.ttsUtterance = SpeechSynthesisUtterance\n                            context.tts.addEventListener('voiceschanged', () => {\n                                context.tts.cancel()\n                                const voices = context.tts.getVoices();\n                                let voiceRe = RegExp(\"en-US\", 'u')\n                                if (process.env.REACT_APP_TTS_VOICE) {\n                                    voiceRe = RegExp(process.env.REACT_APP_TTS_VOICE, 'u')\n                                }\n                                const voice = voices.find((v: any) => voiceRe.test(v.name))!\n                                if (voice) {\n                                    context.voice = voice\n                                    callback('TTS_READY')\n                                } else {\n                                    console.error(`TTS_ERROR: Could not get voice for regexp ${voiceRe}`)\n                                    callback('TTS_ERROR')\n                                }\n                            })\n                        }\n                    },\n                    on: {\n                        TTS_READY: 'idle',\n                        TTS_ERROR: 'fail'\n                    }\n                },\n                idle: {\n                    on: {\n                        LISTEN: 'recognising',\n                        SPEAK: {\n                            target: 'speaking',\n                            actions: assign((_context, event) => { return { ttsAgenda: event.value } })\n                        }\n                    },\n                },\n                recognising: {\n                    initial: 'noinput',\n                    exit: 'recStop',\n                    on: {\n                        ASRRESULT: {\n                            actions: ['recLogResult',\n                                assign((_context, event) => {\n                                    return {\n                                        recResult: event.value\n                                    }\n                                })],\n                            target: '.match'\n                        },\n                        RECOGNISED: 'idle',\n                        SELECT: 'idle',\n                        CLICK: '.pause'\n                    },\n                    states: {\n                        noinput: {\n                            entry: [\n                                'recStart',\n                                send(\n                                    { type: 'TIMEOUT' },\n                                    { delay: (context) => (1000 * (context.tdmPassivity || defaultPassivity)), id: 'timeout' }\n                                )],\n                            on: {\n                                TIMEOUT: '#root.asrtts.idle',\n                                STARTSPEECH: 'inprogress'\n                            },\n                            exit: cancel('timeout')\n                        },\n                        inprogress: {\n                        },\n                        match: {\n                            entry: send('RECOGNISED'),\n                        },\n                        pause: {\n                            entry: 'recStop',\n                            on: { CLICK: 'noinput' }\n                        }\n                    }\n                },\n                speaking: {\n                    entry: 'ttsStart',\n                    on: {\n                        ENDSPEECH: 'idle',\n                        SELECT: 'idle',\n                        CLICK: { target: 'idle', actions: send('ENDSPEECH') }\n                    },\n                    exit: 'ttsStop',\n                },\n                fail: {}\n            }\n        }\n    },\n},\n    {\n        actions: {\n            recLogResult: (context: SDSContext) => {\n                /* context.recResult = event.recResult; */\n                console.log('U>', context.recResult[0][\"utterance\"], context.recResult[0][\"confidence\"]);\n            },\n            logIntent: (context: SDSContext) => {\n                /* context.nluData = event.data */\n                console.log('<< NLU intent: ' + context.nluData.intent.name)\n            }\n        },\n    });\n\n\n\ninterface Props extends React.HTMLAttributes<HTMLElement> {\n    state: State<SDSContext, any, any, any>;\n    alternative: any;\n}\nconst ReactiveButton = (props: Props): JSX.Element => {\n    var promptText = ((props.state.context.tdmVisualOutputInfo || [{}])\n        .find((el: any) => el.attribute === \"name\") || {}).value;\n    var promptImage = ((props.state.context.tdmVisualOutputInfo || [{}])\n        .find((el: any) => el.attribute === \"image\") || {}).value;\n    var circleClass = \"circle\"\n    switch (true) {\n        case props.state.matches({ asrtts: 'fail' }) || props.state.matches({ dm: 'fail' }):\n            break;\n        case props.state.matches({ asrtts: { recognising: 'pause' } }):\n            promptText = \"Click to continue\"\n            break;\n        case props.state.matches({ asrtts: 'recognising' }):\n            circleClass = \"circle-recognising\"\n            promptText = promptText || 'Listening...'\n            break;\n        case props.state.matches({ asrtts: 'speaking' }):\n            circleClass = \"circle-speaking\"\n            promptText = promptText || 'Speaking...'\n            break;\n        case props.state.matches({ dm: 'idle' }):\n            promptText = \"Click to start!\"\n            circleClass = \"circle-click\"\n            break;\n        case props.state.matches({ dm: 'init' }):\n            promptText = \"Click to start!\"\n            circleClass = \"circle-click\"\n            break;\n        default:\n            promptText = promptText || '\\u00A0'\n    }\n    return (\n        <div className=\"control\">\n            <figure className=\"prompt\">\n                {promptImage &&\n                    <img src={promptImage}\n                        alt={promptText} />}\n            </figure>\n            <div className=\"status\">\n                <button type=\"button\" className={circleClass}\n                    style={{}} {...props}>\n                </button>\n                <div className=\"status-text\">\n                    {promptText}\n                </div>\n            </div>\n        </div>);\n}\n\nconst FigureButton = (props: Props): JSX.Element => {\n    const caption = props.alternative.find((el: any) => el.attribute === \"name\").value\n    const imageSrc = (props.alternative.find((el: any) => el.attribute === \"image\") || {}).value\n    return (\n        <figure className=\"flex\" {...props}>\n            {imageSrc &&\n                <img src={imageSrc} alt={caption} />}\n            <figcaption>{caption}</figcaption>\n        </figure>\n    )\n}\n\nfunction App() {\n    const [current, send] = useMachine(machine, {\n        devTools: true,\n        actions: {\n            recStart: asEffect((context) => {\n                context.asr.start()\n                /* console.log('Ready to receive a voice input.'); */\n            }),\n            recStop: asEffect((context) => {\n                context.asr.abort()\n                /* console.log('Recognition stopped.'); */\n            }),\n            ttsStart: asEffect((context) => {\n                const utterance = new context.ttsUtterance(context.ttsAgenda);\n                console.log(\"S>\", context.ttsAgenda)\n                utterance.voice = context.voice\n                utterance.onend = () => send('ENDSPEECH')\n                context.tts.speak(utterance)\n            }),\n            ttsStop: asEffect((context) => {\n                /* console.log('TTS STOP...'); */\n                context.tts.cancel()\n            }),\n            ponyfillASR: asEffect((context, _event) => {\n                const\n                    { SpeechRecognition }\n                        = createSpeechRecognitionPonyfill({\n                            audioContext: context.audioCtx,\n                            credentials: {\n                                region: REGION,\n                                authorizationToken: context.azureAuthorizationToken,\n                            }\n                        });\n                context.asr = new SpeechRecognition()\n                context.asr.lang = process.env.REACT_APP_ASR_LANGUAGE || 'en-US'\n                context.asr.continuous = true\n                context.asr.interimResults = true\n                context.asr.onresult = function(event: any) {\n                    var result = event.results[0]\n                    if (result.isFinal) {\n                        send({\n                            type: \"ASRRESULT\", value:\n                                [{\n                                    \"utterance\": result[0].transcript,\n                                    \"confidence\": result[0].confidence\n                                }]\n                        })\n                    } else {\n                        send({ type: \"STARTSPEECH\" });\n                    }\n                }\n\n            })\n        }\n    });\n    const figureButtons = (current.context.tdmExpectedAlternatives || []).filter((o: any) => o.visual_information)\n        .map(\n            (o: any, i: any) => (\n                <FigureButton state={current}\n                    alternative={o.visual_information}\n                    key={i}\n                    onClick={() => send({ type: 'SELECT', value: o.semantic_expression })} />\n            )\n        )\n\n    switch (true) {\n        default:\n            return (\n                <div className=\"App\">\n                    <ReactiveButton state={current} alternative={{}} onClick={() => send('CLICK')} />\n                    <div className=\"select-wrapper\">\n                        <div className=\"select\">\n                            {figureButtons}\n                        </div>\n                    </div>\n                </div>\n            )\n    }\n\n};\n\nconst getAuthorizationToken = () => (\n    fetch(new Request(TOKEN_ENDPOINT, {\n        method: 'POST',\n        headers: {\n            'Ocp-Apim-Subscription-Key': process.env.REACT_APP_SUBSCRIPTION_KEY!\n        },\n    })).then(data => data.text()))\n\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n    <App />,\n    rootElement);\n"],"sourceRoot":""}