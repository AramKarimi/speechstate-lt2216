(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{176:function(t,e,n){},228:function(t,e){},367:function(t,e){},370:function(t,e){},374:function(t,e){},375:function(t,e){},376:function(t,e){},377:function(t,e){},378:function(t,e){},467:function(t,e,n){"use strict";n.r(e);var i=n(172),a=n(31),o=(n(176),n(14),n(166)),s=n(18),r=n(98),c=n(3),u=n(470),d=n(471),l=n(51),p=n.n(l),E={version:"3.3",session:{session:{my_frontend:{user_id:"speechstate",position:{latitude:"57.699188",longitude:"11.948313"}}}},request:{start_session:{}}},T=function(t){return fetch(new Request("https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)})).then((function(t){return t.json()}))},_={initial:"init",states:{init:{on:{CLICK:"tdm"}},tdm:{initial:"start",states:{start:{invoke:{id:"startSession",src:function(t,e){return T(E)},onDone:[{target:"utter",actions:Object(c.b)({sessionId:function(t,e){return e.data.session.session_id},tdmUtterance:function(t,e){return e.data.output.utterance},tdmPassivity:function(t,e){return e.data.output.expected_passivity},tdmActions:function(t,e){return e.data.output.actions}}),cond:function(t,e){return e.data.output}},{target:"fail"}],onError:{target:"fail"}}},utter:{initial:"prompt",on:{RECOGNISED:"next",TIMEOUT:"passivity"},states:{prompt:{entry:Object(c.q)((function(t){return{type:"SPEAK",value:t.tdmUtterance}})),on:{ENDSPEECH:[{target:"#root.dm.init",cond:function(t,e){return t.tdmActions.some((function(t){return"EndSession"===t.name}))}},{target:"ask"}]}},ask:{entry:[Object(c.q)("LISTEN")]}}},next:{invoke:{id:"nlInput",src:function(t,e){return T((n=t.sessionId,i=t.recResult,{version:"3.3",session:{session_id:n},request:{natural_language_input:{modality:"speech",hypotheses:i}}}));var n,i},onDone:[{target:"utter",actions:Object(c.b)({tdmUtterance:function(t,e){return e.data.output.utterance},tdmPassivity:function(t,e){return e.data.output.expected_passivity},tdmActions:function(t,e){return e.data.output.actions}}),cond:function(t,e){return e.data.output}},{target:"fail"}],onError:{target:"fail"}}},passivity:{invoke:{id:"passivity",src:function(t,e){return T({version:"3.3",session:{session_id:t.sessionId},request:{passivity:{}}})},onDone:[{target:"utter",actions:Object(c.b)({tdmUtterance:function(t,e){return e.data.output.utterance},tdmPassivity:function(t,e){return e.data.output.expected_passivity},tdmActions:function(t,e){return e.data.output.actions}}),cond:function(t,e){return e.data.output}},{target:"fail"}],onError:{target:"fail"}}},fail:{}}}}},S="_"+Math.random().toString(36).substr(2,9),f={initial:"init",states:{init:{entry:Object(c.b)({ttsAgenda:function(t,e){return"\u041f\u0440\u0438\u0432\u0435\u0442! \u0421\u043f\u0440\u043e\u0441\u0438 \u043c\u0435\u043d\u044f \u0447\u0442\u043e-\u043d\u0438\u0431\u0443\u0434\u044c."}}),on:{CLICK:"jaicp"}},jaicp:{initial:"utter",states:{utter:{initial:"prompt",states:{prompt:{entry:Object(c.q)((function(t){return{type:"SPEAK",value:t.ttsAgenda}})),on:{ENDSPEECH:"ask"}},ask:{entry:Object(c.q)("LISTEN")}},on:{RECOGNISED:"next"}},next:{invoke:{id:"nlInput",src:function(t,e){return n=t.recResult[0].utterance,fetch(new Request("https://bot.jaicp.com/chatapi/NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({clientId:"speechstate_"+S,query:n})})).then((function(t){return t.json()}));var n},onDone:[{target:"utter",actions:Object(c.b)({ttsAgenda:function(t,e){return e.data.data.answer}}),cond:function(t,e){return""!==e.data.data.answer}},{target:"#root.dm.fail"}],onError:{target:"#root.dm.fail"}}}}},fail:{}}},O=Object(c.q)((function(t){return{type:"SPEAK",value:"Repainting to ".concat(t.recResult[0].utterance)}}));function b(t){return Object(c.q)((function(e){return{type:"SPEAK",value:t}}))}var P={initial:"init",states:{init:{on:{CLICK:"welcome"}},welcome:{initial:"prompt",on:{RECOGNISED:[{target:"repaint"}]},states:{prompt:{entry:b("Tell me the colour"),on:{ENDSPEECH:"ask"}},ask:{entry:Object(c.q)("LISTEN")}}},stop:{entry:b("Ok"),always:"init"},repaint:{initial:"prompt",states:{prompt:{entry:O,on:{ENDSPEECH:"repaint"}},repaint:{entry:"changeColour",always:"#root.dm.welcome"}}}}},R=n(99),A=n.n(R),C=n(169),m=n.n(C),h=n(11),g=P;"TDM"===Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_BACKEND?g=_:"JAICP"===Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_BACKEND&&(g=f);var N=s.a.send,v=s.a.cancel,j="northeurope";Object(d.a)({url:"https://statecharts.io/inspect",iframe:!1});var y=Object(r.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},g),asrtts:{initial:"prepare",states:{prepare:{invoke:{id:"getAuthorizationToken",src:function(t,e){return K()},onDone:{actions:[Object(c.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillTTS","ponyfillASR"],target:"idle"},onError:{target:"fail"}}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(c.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",entry:"recStart",exit:"recStop",invoke:{id:"asrService",src:function(t,e){return function(t,e){}}},on:{ASRRESULT:{actions:["recLogResult",Object(c.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle"},states:{noinput:{entry:N({type:"TIMEOUT"},{delay:function(t){return 1e4},id:"timeout"}),on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:v("timeout")},inprogress:{},match:{entry:N("RECOGNISED")}}},speaking:{invoke:{id:"ttsStart",src:function(t,e){return function(e,n){var i=new t.ttsUtterance(t.ttsAgenda),a=t.tts.getVoices(),o=RegExp("en-US","u");Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_TTS_VOICE&&(o=RegExp(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_TTS_VOICE,"u"));var s=a.find((function(t){return o.test(t.name)}));s?(i.voice=s,i.onend=function(){return e("ENDSPEECH")},console.log("".concat(i.voice.name," is speaking")),t.tts.speak(i)):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(o)),e("TTS_ERROR"))}}},on:{ENDSPEECH:"idle",TTS_ERROR:"fail"}},fail:{}}}}},{actions:{recLogResult:function(t){console.log("<< ASR: "+t.recResult[0].utterance)},test:function(){console.log("test")},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),I=function(t){switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("div",{className:"status",children:"Something went wrong..."}),Object(h.jsx)("button",Object(a.a)({type:"button",className:"circle",style:{}},t))]});case t.state.matches({asrtts:"recognising"}):return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("div",{className:"status-talk",children:"talk"}),Object(h.jsx)("button",Object(a.a)({type:"button",className:"circle",style:{animation:"bordersize 2s infinite"}},t))]});case t.state.matches({asrtts:"speaking"}):return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("div",{className:"status",children:"speaking"}),Object(h.jsx)("button",Object(a.a)({type:"button",className:"circle-speaking",style:{animation:"bordering 2s infinite"}},t))]});case t.state.matches({dm:"init"}):return Object(h.jsxs)("div",Object(a.a)(Object(a.a)({className:"control"},t),{},{children:[Object(h.jsx)("div",{className:"status-talk",children:"click to start!"}),Object(h.jsx)("button",{type:"button",className:"circle-click",style:{}})]}));default:return Object(h.jsxs)("div",{className:"control",children:[Object(h.jsx)("div",{className:"status-talk"}),Object(h.jsx)("button",Object(a.a)({type:"button",className:"circle",style:{}},t))]})}};function D(){var t=Object(u.b)(y,{devTools:!0,actions:{recStart:Object(u.a)((function(){console.log("Ready to receive a voice input."),p.a.startListening({continuous:!0,language:Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_ASR_LANGUAGE||"en-US"})})),recStop:Object(u.a)((function(){console.log("Recognition stopped."),p.a.stopListening()})),ttsStart:Object(u.a)((function(t){var e=t.tts.getVoices(),n=new t.ttsUtterance(t.ttsAgenda),i=RegExp("en-US-AriaNeural","u");Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_TTS_VOICE&&(i=RegExp(Object({NODE_ENV:"production",PUBLIC_URL:"/speechstate",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_TDM_ENDPOINT:"https://sourdough-for-dummies-orchestration-pipeline.eu2.ddd.tala.cloud/interact",REACT_APP_SUBSCRIPTION_KEY:"2e15e033f605414bbbfe26cb631ab755",REACT_APP_JAICP_TOKEN:"NRBTzSQe:69ae9a334ee112ff9a006af3639ed243ec38e431"}).REACT_APP_TTS_VOICE,"u")),n.voice=e.find((function(t){return i.test(t.name)})),console.log("".concat(n.voice.name," is speaking")),n.onend=function(){return a("ENDSPEECH")},t.tts.speak(n)})),ttsCancel:Object(u.a)((function(){console.log("TTS STOP..."),speechSynthesis.cancel()})),ponyfillTTS:Object(u.a)((function(t,e){var n=m()({credentials:{region:j,authorizationToken:t.azureAuthorizationToken}}),i=n.speechSynthesis,a=n.SpeechSynthesisUtterance;t.tts=i,t.ttsUtterance=a})),ponyfillASR:Object(u.a)((function(t,e){var n=A()({credentials:{region:j,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;p.a.applyPolyfill(n),t.asr=p.a.getRecognition(),t.asr.onresult=function(t){var e=t.results[0];e.isFinal?a({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):a({type:"STARTSPEECH"})}}))}}),e=Object(i.a)(t,2),n=e[0],a=e[1];return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(I,{state:n,onClick:function(){return a("CLICK")}})})}var K=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"2e15e033f605414bbbfe26cb631ab755"}})).then((function(t){return t.text()}))},k=document.getElementById("root");o.render(Object(h.jsx)(D,{}),k)}},[[467,1,2]]]);
//# sourceMappingURL=main.89c5df32.chunk.js.map