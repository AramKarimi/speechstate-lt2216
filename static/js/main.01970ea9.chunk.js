(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{105:function(t,e,n){},154:function(t,e){},270:function(t,e){},291:function(t,e){},294:function(t,e){},302:function(t,e){},303:function(t,e){},304:function(t,e){},305:function(t,e){},306:function(t,e){},310:function(t,e){},337:function(t,e,n){"use strict";n.r(e);var a=n(101),o=n(20),c=n(27),s=n.n(c),i=n(61),r=(n(105),n(12)),u=n(98),l=n(21),p=n(59),f=n(3),b=n(340),g=n(341),h=n(38),S=n.n(h),d=n(60),O=n.n(d),j=n(99),m=n.n(j),y=Object(f.q)((function(t){return{type:"SPEAK",value:"Repainting to ".concat(t.recResult)}}));function E(t){return Object(f.q)((function(e){return{type:"SPEAK",value:t}}))}var v={initial:"init",states:{init:{on:{CLICK:"welcome"}},welcome:{initial:"prompt",on:{RECOGNISED:[{target:"repaint"}]},states:{prompt:{entry:E("Tell me the colour"),on:{ENDSPEECH:"ask"}},ask:{entry:Object(f.q)("LISTEN")}}},stop:{entry:E("Ok"),always:"init"},repaint:{initial:"prompt",states:{prompt:{entry:y,on:{ENDSPEECH:"repaint"}},repaint:{entry:"changeColour",always:"#root.dm.welcome"}}}}},x=n(24),R=speechSynthesis,T=SpeechSynthesisUtterance,k="https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",w="northeurope";Object(i.a)(s.a.mark((function t(){var e,n,a,o,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(k,{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"2768ca1669b44fa1b5beaaaed2938853"}});case 3:return e=t.sent,t.next=6,e.text();case 6:return n=t.sent,t.next=9,m()({credentials:{region:w,authorizationToken:n}});case 9:a=t.sent,o=a.speechSynthesis,c=a.SpeechSynthesisUtterance,R=o,T=c,t.next=17;break;case 15:t.prev=15,t.t0=t.catch(0);case 17:case"end":return t.stop()}}),t,null,[[0,15]])})))(),Object(g.a)({url:"https://statecharts.io/inspect",iframe:!1});var C=l.a.send,N=l.a.cancel,A=Object(p.a)({id:"root",type:"parallel",states:{dm:Object(o.a)({},v),asrtts:{initial:"idle",states:{idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(f.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",entry:"recStart",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(f.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle"},states:{noinput:{entry:C({type:"TIMEOUT"},{delay:function(t){return 5e3},id:"timeout"}),on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:N("timeout")},inprogress:{},match:{entry:C("RECOGNISED")}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle"}}}}}},{actions:{recLogResult:function(t){console.log("<< ASR: "+t.recResult[0].utterance)},test:function(){console.log("test")},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),L=function(t){switch(!0){case t.state.matches({asrtts:"recognising"}):return Object(x.jsx)("button",Object(o.a)(Object(o.a)({type:"button",className:"glow-on-hover",style:{animation:"glowing 20s linear"}},t),{},{children:"Listening..."}));case t.state.matches({asrtts:"speaking"}):return Object(x.jsx)("button",Object(o.a)(Object(o.a)({type:"button",className:"glow-on-hover",style:{animation:"bordering 1s infinite"}},t),{},{children:"Speaking..."}));case t.state.matches({dm:"fail"}):return Object(x.jsx)("button",Object(o.a)(Object(o.a)({type:"button",className:"glow-on-hover"},t),{},{children:"FAILURE! reload the page"}));default:return Object(x.jsx)("button",Object(o.a)(Object(o.a)({type:"button",className:"glow-on-hover"},t),{},{children:"Click to start"}))}};function P(){r.useEffect((function(){function t(){return(t=Object(i.a)(s.a.mark((function t(){var e,n,a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(k,{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"2768ca1669b44fa1b5beaaaed2938853"}});case 2:return e=t.sent,t.next=5,e.text();case 5:return n=t.sent,t.next=8,O()({credentials:{region:w,authorizationToken:n}});case 8:a=t.sent,c=a.SpeechRecognition,S.a.applyPolyfill(c),S.a.getRecognition().onresult=function(t){console.log(t.results);var e=t.results[0];e.isFinal?o({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):o({type:"STARTSPEECH"})};case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]);var t=Object(b.b)(A,{devTools:!0,actions:{recStart:Object(b.a)((function(){console.log("Ready to receive a voice input."),S.a.startListening({continuous:!0,language:"en-US"})})),recStop:Object(b.a)((function(){console.log("Recognition stopped."),S.a.stopListening()})),ttsStart:Object(b.a)((function(t){console.log("Speaking...");var e=R.getVoices();console.log(e);var n=new T(t.ttsAgenda);n.voice=e.find((function(t){return/en\x2DUS\x2DAriaNeural/.test(t.name)})),n.onend=function(){return o("ENDSPEECH")},R.speak(n)})),ttsCancel:Object(b.a)((function(){console.log("TTS STOP..."),speechSynthesis.cancel()}))}}),e=Object(a.a)(t,3),n=e[0],o=e[1];e[2];return Object(x.jsx)("div",{className:"App",children:Object(x.jsx)(L,{state:n,onClick:function(){return o("CLICK")}})})}var I=document.getElementById("root");u.render(Object(x.jsx)(P,{}),I)}},[[337,1,2]]]);
//# sourceMappingURL=main.01970ea9.chunk.js.map